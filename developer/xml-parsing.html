

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>XML Parsing &mdash; SimplePie: User and Developer Guide</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/sphinx_tabs/tabs.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/sphinx_tabs/semantic-ui-2.2.7/segment.min.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/sphinx_tabs/semantic-ui-2.2.7/menu.min.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/sphinx_tabs/semantic-ui-2.2.7/tab.min.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="SimplePie: User and Developer Guide" href="../index.html"/>
        <link rel="next" title="Interfaces (Draft)" href="interfaces.html"/>
        <link rel="prev" title="JSON Parsing (Draft)" href="json-parsing.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> SimplePie NG
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user/foundation.html">Foundation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../user/foundation.html#lies-damned-lies-and-statistics">Lies, damned lies, and statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/foundation.html#json">JSON</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/foundation.html#domdocument">DOMDocument</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/foundation.html#xpath">XPath</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/foundation.html#decoupled-components">Decoupled Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/foundation.html#middleware">Middleware</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/foundation.html#standards">Standards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/foundation.html#doing-less">Doing Less</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/foundation.html#coding-standards">Coding Standards</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../user/configuration.html">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../user/configuration.html#logger">Logger</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/configuration.html#middleware">Middleware</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/configuration.html#libxml">libxml</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../user/usage.html">General Usage (Draft)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../user/usage.html#fetching-feeds-over-http">Fetching Feeds Over HTTP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/usage.html#caching-data">Caching Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/usage.html#working-with-node-types">Working with <code class="docutils literal"><span class="pre">Node</span></code> types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/usage.html#working-with-datetime-types">Working with <code class="docutils literal"><span class="pre">DateTime</span></code> types</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../user/license.html">License: Why Apache 2.0?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../user/license.html#short-and-permissive">Short and Permissive</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/license.html#gpl-lgpl-agpl-and-free-software">GPL, LGPL, AGPL, and “Free Software”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/license.html#so-why-apache-2-0">So, why Apache 2.0?</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ref/api-reference.html">API Reference</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="start.html">Getting Started (Draft)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="start.html#php-dependencies">PHP Dependencies</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dependencies.html">Development Dependencies</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dependencies.html#core-tools">Core Tools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="dependencies.html#docker-and-docker-compose">Docker and Docker Compose</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="dependencies.html#optional-tools">Optional Tools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="dependencies.html#vagrant">Vagrant</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="vagrant.html">Leveraging Vagrant (Optional)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="vagrant.html#i-am-using-macos">I am using macOS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="vagrant.html#install-xcode-cli-development-tools">Install Xcode CLI Development Tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="vagrant.html#give-yourself-passwordless-sudo-optional">Give yourself passwordless sudo (optional)</a></li>
<li class="toctree-l3"><a class="reference internal" href="vagrant.html#install-homebrew">Install Homebrew</a></li>
<li class="toctree-l3"><a class="reference internal" href="vagrant.html#install-vagrant-plug-ins">Install Vagrant plug-ins</a></li>
<li class="toctree-l3"><a class="reference internal" href="vagrant.html#selecting-virtual-machine-software">Selecting Virtual Machine Software</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="vagrant.html#i-am-using-windows">I am using Windows</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="docker.html">Leveraging Docker (Draft)</a></li>
<li class="toctree-l1"><a class="reference internal" href="json-parsing.html">JSON Parsing (Draft)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="json-parsing.html#high-level-internals">High-Level Internals</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">XML Parsing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#high-level-internals">High-Level Internals</a></li>
<li class="toctree-l2"><a class="reference internal" href="#html-entities">HTML Entities</a></li>
<li class="toctree-l2"><a class="reference internal" href="#xml-namespaces">XML Namespaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="#xpath-1-0">XPath 1.0</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="interfaces.html">Interfaces (Draft)</a></li>
<li class="toctree-l1"><a class="reference internal" href="alias-handler.html">Aliases and Handlers (Draft)</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Unit and Integration Testing (Draft)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="testing.html#unit-tests">Unit Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="testing.html#integration-test-schema">Integration Test Schema</a></li>
<li class="toctree-l2"><a class="reference internal" href="testing.html#all-at-once">All at Once</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">SimplePie NG</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>XML Parsing</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/developer/xml-parsing.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="xml-parsing">
<h1>XML Parsing<a class="headerlink" href="#xml-parsing" title="Permalink to this headline">¶</a></h1>
<p>XML (<a class="reference external" href="https://www.w3.org/TR/2008/REC-xml-20081126/">REC-xml-20081126</a>) is the intended serialization of the
<a class="reference external" href="https://tools.ietf.org/html/rfc4287">Atom</a> and <a class="reference external" href="http://www.rssboard.org/rss-specification">RSS</a> formats. As such,
SimplePie NG has been designed from the beginning with support for multiple feed serialization types.</p>
<div class="section" id="high-level-internals">
<h2>High-Level Internals<a class="headerlink" href="#high-level-internals" title="Permalink to this headline">¶</a></h2>
<p>Internally, we use the <a class="reference external" href="http://php.net/manual/en/class.domdocument.php">DOMDocument</a> family of classes to parse the
XML data into an object. The internal XML parser is <a class="reference external" href="http://xmlsoft.org">libxml2</a> which implements the spec, but also
has some niceties such as the ability to <a class="reference external" href="https://secure.php.net/manual/en/class.domdocument.php#domdocument.props.recover">recover from malformed
XML</a>. This is a tremendous
improvement over SimplePie OG’s usage of the <a class="reference external" href="http://php.net/manual/en/ref.xml.php">XML Parser</a> functions leftover
from PHP 4.</p>
</div>
<div class="section" id="html-entities">
<h2>HTML Entities<a class="headerlink" href="#html-entities" title="Permalink to this headline">¶</a></h2>
<p>There are (generally) two kinds of entities: (a) <em>named</em> entities (e.g., <code class="docutils literal"><span class="pre">&amp;nbsp;</span></code>) and (b) <em>numeric</em> entities (e.g.,
<code class="docutils literal"><span class="pre">&amp;#xA0;</span></code> or <code class="docutils literal"><span class="pre">&amp;#160;</span></code>).</p>
<p>Most of the <em>named entities</em> defined in HTML are <em>not</em> defined in XML. This means that unless the feed author (or the
feed-generating software) is diligent about using CDATA to wrap these named entities, most XML parsers will fail. (This
was a problem that plagued SimplePie OG, and was the source of a tremendous amount of workarounds in the source code.)</p>
<p>SimplePie NG handles things differently. Firstly, it uses the
<a class="reference external" href="http://php.net/manual/en/class.domdocument.php">DOMDocument</a> family of classes which are higher-level than the old
XML Parser code. Secondly, since <a class="reference external" href="http://xmlsoft.org">libxml2</a> offers a recovery bit, it will continue parsing the
document even if it encounters these kinds of errors. Thirdly, we now fetch and maintain a <a class="reference external" href="https://www.w3.org/TR/html5/entities.json">canonical list of entity
mappings defined for HTML5</a> from the W3C, that we can use to handle
un-CDATA’d named entities in XML.</p>
<p>At present, this named entity handling is disabled by default for two reasons: (a) we don’t yet have enough test
coverage to help us avoid <a class="reference external" href="https://www.owasp.org/index.php/XML_External_Entity_(XXE)_Processing">XML External Entity</a>
vulnerabilities, and (b) because this involves us modifying the XML on the fly to insert our entity definitions (which
is slightly slower).</p>
</div>
<div class="section" id="xml-namespaces">
<h2>XML Namespaces<a class="headerlink" href="#xml-namespaces" title="Permalink to this headline">¶</a></h2>
<p>SimplePie NG leverages the <code class="docutils literal"><span class="pre">DOMDocument</span></code> class to parse XML. A big part of parsing XML is working with elements that
are namespaced. We keep track of many <a class="reference external" href="https://github.com/simplepie/simplepie-ng/wiki/XML-Namespace-URIs">XML Namespace
URIs</a> in our wiki. For the most part, these URIs
are applied in a standard way across all feeds.</p>
<p>However, there are a few cases where the authors of the specification were inconsistent in the naming of their XML
Namespace URI, and various edits of the specification over the years resulted in feeds with various URIs for the same
specification. This was troublesome for SimplePie OG, which attempted to map elements to well-known URIs. One of the
biggest offenders was Yahoo! with the <a class="reference external" href="https://github.com/simplepie/simplepie-ng/wiki/Spec%3A-Media-RSS">Media RSS
spec</a>, who gave the spec three different URIs over
the course of Yahoo!’s ownership.</p>
<p>SimplePie NG addresses this differently. All feed formats are processed using middleware, and each XML-based middleware
registers the XML Namespace URIs it understands. This is an array, which means that you can register multiple URIs. When
SimplePie parses a feed, it executes the middleware stack to determine how to handle it. When the middleware is
executed, it attempts to match the feed’s XML Namespace URI against what it understands. If there is an exact match in
the list, we know that we can parse it. If we don’t get an exact match, SimplePie tries to match again as though the
middleware-provided URI were a regex.</p>
<p>If a middleware handler is not found, the namespaced elements are not parsed.</p>
</div>
<div class="section" id="xpath-1-0">
<h2>XPath 1.0<a class="headerlink" href="#xpath-1-0" title="Permalink to this headline">¶</a></h2>
<p>As part of leveraging <code class="docutils literal"><span class="pre">DOMDocument</span></code> for XML handling, we have access to the
<a class="reference external" href="http://php.net/manual/en/class.domxpath.php">DOMXPath</a> class. PHP’s XPath processing of XML data is <em>substantially</em>
more performant than looping over PHP arrays in userland code. As such, all first-party middleware uses XPath
expressions for retrieving data from feeds.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Despite the fact that <a class="reference external" href="https://www.w3.org/TR/xpath20/">XPath 2.0</a>,
<a class="reference external" href="https://www.w3.org/TR/xpath-30/">3.0</a>, and <a class="reference external" href="https://www.w3.org/TR/xpath-31/">3.1</a> exist, PHP is limited to
<a class="reference external" href="https://www.w3.org/TR/xpath/">XPath 1.0</a>.</p>
</div>
<p>The <code class="docutils literal"><span class="pre">AbstractXmlMiddleware</span></code> class provided by SimplePie NG has methods which support case-insensitive XPath
expressions, meaning that <code class="docutils literal"><span class="pre">&lt;pubDate&gt;</span></code>, <code class="docutils literal"><span class="pre">&lt;pubdate&gt;</span></code>, and <code class="docutils literal"><span class="pre">&lt;PubDate&gt;</span></code> will all resolve correctly with the same XPath
expression.</p>
<p>Custom, third-party XML-based middleware is encouraged to extend this class and leverage these methods for the
broadest-possible compatibility. Improvements made to the underlying methods will automatically improve any extending
middleware.</p>
<div class="reviewed admonition">
<p class="first admonition-title">Review</p>
<p class="last">Written on 2017-12-17, proofread on 2017-12-26.</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="interfaces.html" class="btn btn-neutral float-right" title="Interfaces (Draft)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="json-parsing.html" class="btn btn-neutral" title="JSON Parsing (Draft)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017 Ryan Parman.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/sphinx_tabs/tabs.js"></script>
      <script type="text/javascript" src="../_static/sphinx_tabs/semantic-ui-2.2.7/tab.min.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>